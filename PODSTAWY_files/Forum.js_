var Forum={Data:{urls:{saveForumPosition:null}},can_delete:!1,is_mod:!1,thread_open:!0,is_last_page:!1,init:function(e){Forum.Data.urls=e,UI.Sortable($("#sortable_forums"),{axis:"y",handle:".qbhandle",stop:function(e,t){$.ajax({type:"post",url:Forum.Data.urls.saveForumPosition,data:$("#sortable_forums").sortable("serialize"),success:function(e,t){}})}})},addPollOption:function(){var e=$("#poll_options").children("input").length+2+1,t=$("<input />").attr("name","poll_options[]").attr("type","text").attr("size","64").attr("value","").attr("maxlength","50").attr("class","answer").attr("tabindex",e);$("#poll_options").append(t).append($("<br />"))},addPollOptionMobile:function(){var e=$("#poll_options").children("input").length+2+1,t=$("<input />").attr("name","poll_options[]").attr("type","text").attr("value","").attr("maxlength","50").attr("class","answer").attr("tabindex",e).css({width:"90%"});$("#poll_options").append(t).append($("<br />"))},initPollClose:function(){0==$("#close_days").val()?$("#close_days").attr("disabled",!0):$("#close_days_check").attr("checked",!0),$("#close_days_check").change(function(){this.checked?$("#close_days").attr("disabled",!1):$("#close_days").attr("disabled",!0).val(0)})},sharingAdd:function(e,t){TribalWars.post("forum_api",{ajaxaction:"add_share"},{ally_tag:$("#"+e).val(),forum_id:t},function(e){e.error?UI.ErrorMessage(e.error):($("#shared_"+t).empty(),$("#shared_"+t).html(e.new_shares),$("#add_shares_link_"+t).css("display","none"),$("#edit_shares_link_"+t).css("display",""),Dialog.close())})},sharingRemove:function(e,t,a){var s=[];$("#checkboxes").find("input").each(function(e,t){$(t).is(":checked")&&s.push($(t).val())}),TribalWars.post("forum_api",{ajaxaction:"remove_shares"},{remove:$.makeArray(s),forum_id:t},function(a){a.error?UI.ErrorMessage(a.error):($("#"+e).empty(),a.new_shares?$("#"+e).html(a.new_shares):($("#add_shares_link_"+t).css("display",""),$("#edit_shares_link_"+t).css("display","none")),Dialog.close())})},changePage:function(e){var t={selected_action:$(e).data("action"),current_page:$('input[name="current_page"]').val()};TribalWars.post("forum",{ajax:"change_recent_posts"},t,function(e){$("#recent-posts-container").html(e)})},toggleWidget:function(e,t=!1){var a=e.dataset.widget;if(null!==a){if(mobile)$('[data-widget="'+a+'"]').toggleClass("hidden-el");else{var s=$(e).parent().next();s.toggle(),e.src=s.is(":hidden")?"graphic/plus.png":"graphic/minus.png"}TribalWars.post("forum",{ajax:"toggle_widget"},{widget:a})}},updateReplies:function(e){var t=new URLSearchParams(window.location.search);if(e.thread==t.get("thread_id")&&this.is_last_page){var a=mobile?$(e.mobile):$(e.web);a.find("a").each(function(){var e=$(this).attr("href").split("?");if(-1!==e[1].indexOf("#"))var t=e[1].split("#"),a=new URLSearchParams(t[0]),s=t[1];else a=new URLSearchParams(e[1]),s=!1;a.has("h")&&a.set("h",window.csrf_token);var n=e[0]+"?"+a.toString();s&&(n+="#"+s),$(this).attr("href",n)}),Forum.thread_open&&(Forum.is_mod||(a.find("input.chk_del_posts").remove(),a.find("a.post-edit-link, span.post-edit-link").remove(),Forum.can_delete||a.find("a.post-delete-link, span.post-delete-link").remove())),mobile?$("#forum_post_list").append(a):$("#forum_post_list .post:last").after(a),TribalWars.post("forum_api",{ajaxaction:"mark_post_read"},{post_id:e.post_id})}},deletePosts:function(){var e=[{text:_("70d9be9b139893aa6c69b5e77e614311"),callback:function(){$('form[name="del_posts"]').submit()},confirm:!0}];return UI.ConfirmationBox(_("880d4b627740d6e9e144e39aff7aeb91"),e),!1},registerEvents:function(){$(".widget-toggle").on("click",function(e){Forum.toggleWidget(e.currentTarget)}),$(".widget-close").on("click",function(e){Forum.toggleWidget(e.currentTarget,!0)})}};$(function(){$(".thanksnum > a").click(function(){var e=$(this).parents(".post_thanks").find(".post_thanks_who");return e.is(":visible")?($(this).text(_("498f79c4c5bbde77f1bceb6c86fd0f6d")),e.hide("fast")):($(this).text(_("62a5e490880a92eef74f167d9dc6dca0")),e.show("fast")),!1})});
